{@java.util.ArrayList<String> keys}
{@java.util.HashMap tIds}
{@java.lang.String selectedId}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hello {name ?: "Qute"}</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        #map{
            height: 100vh;
        }

        .leaflet-bottom{
            visibility: hidden;
        }

        html, body{
            overflow: hidden;
            margin: 0;
        }

        switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        #button-container{
            width: 60px;
            height: 35px;
            position: fixed;
            top: 0;
            right: 0;
            z-index: 9999;
        }
    </style>
</head>
<body>

    <label for="person">Choose a person:</label>
    <select name="person" id="personSelect" onchange="checkSelection()">
        <option value="">select</option>
        {#each key in keys}
            <option value="{key}">{key}</option>
        {/each}
    </select>

    <div id="map"></div>

    <script>
        const tIds = {
            {#each key in keys}
            "{key}": "{tIds.get(key)}",
            {/each}
        };

        let map; // Declare map variable globally
        let marker; // Declare marker variable globally

        // Initialize the map
        function initMap() {
            map = L.map('map').setView([0, 0], 2); // Initialize map with a default view
            L.tileLayer('https://tile.openstreetmap.org/\{z}\/\{x}\/\{y}\.png').addTo(map);
        }

        // Change the marker position based on the selected person
        function checkSelection() {
            const selector = document.getElementById("personSelect").value; // Get the selected value

            if (selector) {
                const coordinates = tIds[selector].split(" "); // Split the coordinates string
                const lat = parseFloat(coordinates[1]); // Convert to float
                const lon = parseFloat(coordinates[0]); // Convert to float

                // Update map view
                map.setView([lat, lon], 13); // Change the map view

                // If the marker is not yet created, create it
                if (!marker) {
                    marker = L.marker([lat, lon]).addTo(map)
                        .bindPopup('Last Position')
                        .openPopup();
                } else {
                    // Move the existing marker to the new position
                    marker.setLatLng([lat, lon]).update();
                }
            }
        }

        initMap();
    </script>

</body>
</html>
